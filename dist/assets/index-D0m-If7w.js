import{t as y,r as i,j as e,B as o,u as _}from"./index-B_HhO1BD.js";import{I}from"./input-C9qR2CI3.js";import{C as ee,a as se,b as te,c as ae,d as re}from"./card-DQDZF1f8.js";import{B as P}from"./badge-Dxifg8Bp.js";import{S as ne}from"./separator--964OeUg.js";import{D as B,a as M,b as U,c as b}from"./dropdown-menu-B8Y2P75d.js";import{u as E}from"./dataset-store-BMT2huA0.js";import{D as K,d as V,a as G,b as H,c as Q,e as R}from"./dialog-D8sxmf9z.js";import{L as F}from"./label-BF4fkcO1.js";import{T as ie}from"./textarea-DmBfN8NY.js";import{P as S,F as le,G as ce,L as oe}from"./plus-_dU-OX-D.js";import{P as de}from"./processing-status-badge-CqUkkuRK.js";import{S as me}from"./search-C4avjcUo.js";import"./index-51J0CxvN.js";import"./index-DYm5icJq.js";import"./index-CWPVk02v.js";import"./index-BFTPONSX.js";import"./index-DiU1bmsz.js";import"./index-C4ZU240X.js";import"./middleware-BFCXRDQO.js";import"./index-CtFV1-CA.js";import"./createLucideIcon-QzJBPPa0.js";import"./circle-check-DsNFNyQa.js";import"./loader-circle-Cx0hSTzX.js";function W(){return{toast:({title:l,description:c,variant:x="info",duration:r=3e3})=>{const n=c?`${l}
${c}`:l;switch(x){case"success":return y.success(n,{duration:r});case"error":return y.error(n,{duration:r});case"warning":return y.warning(n,{duration:r});case"info":default:return y.info(n,{duration:r})}},dismiss:y.dismiss}}function he({open:j,onOpenChange:l,onSuccess:c}){const{createDataset:x,isLoading:r,error:n}=E(),{toast:u}=W(),[d,p]=i.useState(""),[f,h]=i.useState(""),[g,w]=i.useState(""),[m,D]=i.useState([]),k=async t=>{if(t.preventDefault(),!!d.trim())try{await x(d.trim(),f.trim(),m),u({title:"Dataset erstellt",description:`Das Dataset "${d.trim()}" wurde erfolgreich erstellt.`,variant:"success"}),p(""),h(""),w(""),D([]),setTimeout(()=>{l(!1),c?.()},500)}catch(N){console.error("Failed to create dataset:",N),u({title:"Fehler beim Erstellen",description:"Das Dataset konnte nicht erstellt werden. Bitte versuchen Sie es erneut.",variant:"error"})}},v=()=>{const t=g.trim();t&&!m.includes(t)&&(D([...m,t]),w(""))},T=t=>{D(m.filter(N=>N!==t))},C=t=>{t.key==="Enter"&&(t.preventDefault(),v())};return e.jsx(K,{open:j,onOpenChange:l,children:e.jsxs(V,{className:"sm:max-w-[425px]",children:[e.jsxs(G,{children:[e.jsx(H,{children:"Neues Dataset erstellen"}),e.jsx(Q,{children:"Erstellen Sie ein neues Dataset, um Ihre Dateien und Dokumente zu organisieren."})]}),e.jsxs("form",{onSubmit:k,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"name",children:"Name *"}),e.jsx(I,{id:"name",value:d,onChange:t=>p(t.target.value),placeholder:"Dataset-Name eingeben",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"description",children:"Beschreibung"}),e.jsx(ie,{id:"description",value:f,onChange:t=>h(t.target.value),placeholder:"Beschreiben Sie, was dieses Dataset enthält",rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"tags",children:"Tags"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(I,{id:"tags",value:g,onChange:t=>w(t.target.value),onKeyPress:C,placeholder:"Tags hinzufügen"}),e.jsx(o,{type:"button",onClick:v,size:"sm",children:e.jsx(S,{className:"h-4 w-4"})})]}),m.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1",children:m.map(t=>e.jsxs(P,{variant:"secondary",className:"cursor-pointer",onClick:()=>T(t),children:[t," ×"]},t))})]}),n&&e.jsx("div",{className:"text-sm text-red-600 bg-red-50 p-2 rounded",children:n}),e.jsxs(R,{children:[e.jsx(o,{type:"button",variant:"outline",onClick:()=>l(!1),children:"Abbrechen"}),e.jsx(o,{type:"submit",disabled:!d.trim()||r,children:r?"Erstelle...":"Dataset erstellen"})]})]})]})})}function xe({open:j,onOpenChange:l,dataset:c,onSuccess:x}){const{deleteDataset:r,error:n}=E(),[u,d]=i.useState(!1),p=async()=>{d(!0);try{await r(c.id),x?.(),setTimeout(()=>{l(!1)},500)}catch(h){console.error("Failed to delete dataset:",h)}finally{d(!1)}},f=()=>{l(!1)};return e.jsx(K,{open:j,onOpenChange:l,children:e.jsxs(V,{className:"sm:max-w-[425px]",children:[e.jsxs(G,{children:[e.jsx(H,{children:"Dataset löschen"}),e.jsx(Q,{children:"Diese Aktion kann nicht rückgängig gemacht werden."})]}),e.jsxs("div",{className:"py-4",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Möchten Sie das Dataset ",e.jsxs("strong",{children:['"',c.name,'"']})," wirklich löschen?"]}),c.filesCount>0&&e.jsxs("p",{className:"text-sm text-muted-foreground mt-2",children:["Dieses Dataset enthält ",c.filesCount," Datei",c.filesCount===1?"":"en",", die ebenfalls gelöscht werden."]})]}),n&&e.jsxs("div",{className:"text-sm text-destructive bg-destructive/10 p-3 rounded",children:[e.jsx("strong",{children:"Fehler:"})," ",n]}),e.jsxs(R,{children:[e.jsx(o,{type:"button",variant:"outline",onClick:f,disabled:u,children:"Abbrechen"}),e.jsx(o,{type:"button",variant:"destructive",onClick:p,disabled:u,children:u?"Löschen...":"Löschen"})]})]})})}function ue(){const j=_(),{datasets:l,searchDatasets:c,fetchDatasets:x,isLoading:r,error:n,processDatasets:u,getUnprocessedDatasets:d,stopStatusPolling:p,checkAllDatasetStatuses:f}=E(),{toast:h}=W(),[g,w]=i.useState(""),[m,D]=i.useState("grid"),[k,v]=i.useState(!1),[T,C]=i.useState(!1),[t,N]=i.useState(!1),[z,A]=i.useState(null);i.useEffect(()=>{x().catch(s=>{console.error("Failed to fetch datasets:",s)})},[x]),i.useEffect(()=>()=>{p()},[p]);const L=g?c(g):l,q=s=>{try{const a=typeof s=="string"?new Date(s):s;return isNaN(a.getTime())?"Unbekannt":new Intl.DateTimeFormat("de-DE",{year:"numeric",month:"short",day:"numeric"}).format(a)}catch(a){return console.error("Date formatting error:",a,s),"Unbekannt"}},Z=s=>{j({to:`/library/datasets/${s}`})},J=(s,a)=>{a.stopPropagation(),A(s),C(!0)},O=()=>{h({title:"Dataset gelöscht",description:`Das Dataset "${z?.name}" wurde erfolgreich gelöscht.`,variant:"success"}),A(null)},X=async()=>{const s=d();if(s.length===0){h({title:"Keine Datasets zu verarbeiten",description:"Alle Datasets sind bereits verarbeitet oder werden gerade verarbeitet.",variant:"info"});return}N(!0);try{const a=s.map(Y=>Y.id);await u(a),h({title:"Verarbeitung gestartet",description:`${s.length} Dataset${s.length!==1?"s":""} werden verarbeitet.`,variant:"success"}),setTimeout(()=>{f()},1e3)}catch(a){h({title:"Verarbeitung fehlgeschlagen",description:a instanceof Error?a.message:"Unbekannter Fehler",variant:"error"})}finally{N(!1)}},$=d();return e.jsxs("div",{className:"flex flex-1 flex-col gap-4 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold",children:"Datasets"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Verwalten Sie Ihre Datasets und Dateien"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[$.length>0&&e.jsx(o,{size:"sm",variant:"outline",onClick:X,disabled:t,children:t?"Wird verarbeitet...":`Alle verarbeiten (${$.length})`}),e.jsxs(o,{size:"sm",onClick:()=>v(!0),children:[e.jsx(S,{className:"mr-2 h-4 w-4"}),"Neues Dataset"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative flex-1 max-w-sm",children:[e.jsx(me,{className:"absolute left-2 top-1/2 h-3 w-3 -translate-y-1/2 text-muted-foreground"}),e.jsx(I,{placeholder:"Datasets durchsuchen...",value:g,onChange:s=>w(s.target.value),className:"pl-7 h-8 text-sm"})]}),e.jsxs(B,{children:[e.jsx(M,{asChild:!0,children:e.jsxs(o,{variant:"outline",size:"sm",className:"h-8",children:[e.jsx(le,{className:"mr-1 h-3 w-3"}),"Filter"]})}),e.jsxs(U,{children:[e.jsx(b,{children:"Alle Datasets"}),e.jsx(b,{children:"Zuletzt erstellt"}),e.jsx(b,{children:"Meiste Dateien"})]})]}),e.jsxs("div",{className:"flex rounded-md border",children:[e.jsx(o,{variant:m==="grid"?"default":"ghost",size:"sm",onClick:()=>D("grid"),className:"rounded-r-none h-8 px-2",children:e.jsx(ce,{className:"h-3 w-3"})}),e.jsx(o,{variant:m==="list"?"default":"ghost",size:"sm",onClick:()=>D("list"),className:"rounded-l-none h-8 px-2",children:e.jsx(oe,{className:"h-3 w-3"})})]})]}),n&&e.jsxs("div",{className:"text-sm text-red-600 bg-red-50 p-3 rounded border border-red-200",children:[e.jsx("strong",{children:"Fehler:"})," ",n]}),r&&e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"text-sm text-muted-foreground",children:"Lade Datasets..."})}),!r&&L.length===0?e.jsx("div",{className:"flex flex-1 items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto mb-4 h-12 w-12 rounded-full bg-muted flex items-center justify-center",children:e.jsx(S,{className:"h-6 w-6 text-muted-foreground"})}),e.jsx("h3",{className:"text-base font-semibold",children:"Keine Datasets gefunden"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:g?"Versuchen Sie, Ihre Suchbegriffe anzupassen.":"Erstellen Sie Ihr erstes Dataset, um zu beginnen."}),!g&&e.jsxs(o,{size:"sm",onClick:()=>v(!0),children:[e.jsx(S,{className:"mr-2 h-4 w-4"}),"Dataset erstellen"]})]})}):r?null:e.jsx("div",{className:m==="grid"?"grid gap-3 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4":"space-y-3",children:L.map(s=>e.jsxs(ee,{className:"cursor-pointer transition-colors hover:bg-muted/50",onClick:()=>Z(s.id),children:[e.jsx(se,{className:"pb-2",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(te,{className:"text-base",children:s.name}),e.jsx(ae,{className:"mt-1 text-sm",children:s.description})]}),e.jsxs(B,{children:[e.jsx(M,{asChild:!0,children:e.jsx(o,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",onClick:a=>a.stopPropagation(),children:"⋯"})}),e.jsxs(U,{children:[e.jsx(b,{children:"Bearbeiten"}),e.jsx(b,{children:"Duplizieren"}),e.jsx(b,{className:"text-destructive",onClick:a=>J({id:s.id,name:s.name,filesCount:s.files.length},a),children:"Löschen"})]})]})]})}),e.jsx(re,{className:"pt-0",children:e.jsxs("div",{className:"space-y-2",children:[s.tags.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-1",children:[s.tags.slice(0,3).map(a=>e.jsx(P,{variant:"secondary",className:"text-xs",children:a},a)),s.tags.length>3&&e.jsxs(P,{variant:"secondary",className:"text-xs",children:["+",s.tags.length-3]})]}),e.jsx(ne,{}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[e.jsxs("span",{children:[s.files.length," Dateien"]}),e.jsx("span",{children:q(s.createdAt)})]}),e.jsx("div",{className:"mt-2",children:e.jsx(de,{status:s.processingStatus})}),s.files.length>0&&e.jsxs("div",{className:"space-y-1",children:[s.files.slice(0,3).map(a=>e.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[e.jsx("span",{className:"truncate text-xs",children:a.name}),e.jsx("span",{className:"text-xs",children:a.extension?.toUpperCase()||"UNKNOWN"})]},a.id)),s.files.length>3&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["+",s.files.length-3," weitere Dateien"]})]})]})})]},s.id))}),e.jsx(he,{open:k,onOpenChange:v}),z&&e.jsx(xe,{open:T,onOpenChange:C,dataset:z,onSuccess:O})]})}const Ue=ue;export{Ue as component};
